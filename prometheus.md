Introduction to Prometheus

### What is Prometheus?
Prometheus is an open-source systems monitoring and alerting toolkit originally developed by SoundCloud. It‚Äôs now a CNCF project widely used in cloud-native environments.

### Core Components:
- **Prometheus Server** ‚Äì Pulls and stores metrics in a time-series database.
- **Exporters** ‚Äì Agents that expose metrics from applications or infrastructure.
- **Alertmanager** ‚Äì Handles alerts generated by Prometheus queries.
- **PromQL** ‚Äì Query language used to extract and analyze time-series data.

### Why Monitoring Matters in Kubernetes:
- Dynamic scaling, auto-restarts, and ephemeral workloads demand proactive visibility.
- Prometheus tracks system health, resource usage, application performance, and failures.

---

## 2. ‚öôÔ∏è Setting Up Prometheus in EKS

### Prerequisites:
- AWS Account with sufficient IAM permissions.
- AWS CLI installed and configured.
- `kubectl` installed.
- `eksctl` (for easier EKS provisioning).
- `Helm` installed.

### Step-by-Step Guide

#### üõ†Ô∏è Step 1: Create the EKS Cluster
```bash
# Create EKS cluster with eksctl
eksctl create cluster \
  --name prometheus-demo \
  --region us-west-2 \
  --nodes 2 \
  --node-type t3.medium \
  --with-oidc \
  --ssh-access \
  --ssh-public-key your-key-name
```

#### üõ†Ô∏è Step 2: Verify Access to Cluster
```bash
# Update kubeconfig
aws eks --region us-west-2 update-kubeconfig --name prometheus-demo

# Test connectivity
kubectl get nodes
```

---

## 3. üì¶ Installing `kube-prometheus-stack` with Helm

### What is Helm?
Helm is a package manager for Kubernetes that helps you define, install, and upgrade complex Kubernetes applications.

### Add Prometheus Community Helm Repository:
```bash
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
```

### Install the Stack:
```bash
helm install prometheus prometheus-community/kube-prometheus-stack \
  --namespace monitoring \
  --create-namespace
```

### Validate Installation:
```bash
kubectl get pods -n monitoring
```
You should see pods like `prometheus-kube-prometheus`, `grafana`, `alertmanager`, etc.

### Port Forward Grafana and Prometheus:
```bash
# Grafana UI (default login: admin/prom-operator)
kubectl port-forward svc/prometheus-grafana 3000:80 -n monitoring

# Prometheus UI
kubectl port-forward svc/prometheus-kube-prometheus-prometheus 9090 -n monitoring
```

---

## 4. üìä Using Prometheus and Grafana

### Access Prometheus UI:
- Open http://localhost:9090
- Use the "Targets" tab to see metrics endpoints.

### Basic PromQL Queries:
```promql
# CPU usage of all pods
sum(rate(container_cpu_usage_seconds_total[5m])) by (pod)

# Memory usage
sum(container_memory_usage_bytes) by (pod)

# Uptime of Prometheus
up
```

### Access Grafana Dashboard:
- Open http://localhost:3000
- Default credentials: `admin` / `prom-operator`

### Add Prometheus as Data Source:
1. Go to *Settings ‚Üí Data Sources* ‚Üí Add Prometheus.
2. URL: `http://prometheus-kube-prometheus-prometheus.monitoring.svc:9090`

### Import Dashboards:
- Use Grafana dashboard ID from [Grafana.com](https://grafana.com/grafana/dashboards/)
- Examples: Kubernetes cluster monitoring (ID: `315`), Node Exporter (ID: `1860`)

---

## üí° Pro Tips & Troubleshooting
- **Pod CrashLoopBackOff?**
  - Check logs: `kubectl logs <pod> -n monitoring`
  - Check resource limits in Helm values.

- **Missing Grafana UI?**
  - Ensure service type is `ClusterIP` (use port forwarding or change to `LoadBalancer`).

- **Query returns empty?**
  - Try a longer time range.
  - Use the "Targets" tab to verify if Prometheus scrapes the metrics endpoints.

---

